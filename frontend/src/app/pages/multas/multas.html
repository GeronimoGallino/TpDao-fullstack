<div class="multas-crud container">
  <h2>Gestión de Multas</h2>

  <div class="actions">
    <input type="text" placeholder="Buscar..." [(ngModel)]="filter" (ngModelChange)="applyFilter()" />
    <button (click)="newMulta()">Nueva multa</button>
  </div>

  <table class="multas-table" *ngIf="multasFiltered && multasFiltered.length; else emptyList">
    <thead>
      <tr>
        <th>ID Alquiler</th>
        <th>Tipo</th>
        <th>Descripción</th>
        <th>Costo</th>
        <th>Fecha</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let m of multasFiltered; trackBy: trackById">
        <td>{{ m.id_alquiler }}</td>
        <td>{{ m.tipo }}</td>
        <td>{{ m.descripcion }}</td>
        <td>{{ m.costo | currency:'ARS' }}</td>
        <td>{{ m.fecha | date:'yyyy-MM-dd' }}</td>
        <td>
          <button (click)="editMulta(m)">Editar</button>
          <button (click)="confirmDelete(m)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #emptyList>
    <p>No hay multas registradas.</p>
  </ng-template>

  <div class="multa-form" *ngIf="selectedMulta">
    <h3>{{ isEditing ? 'Editar multa' : 'Nueva multa' }}</h3>
    <form #multaForm="ngForm" (ngSubmit)="saveMulta()">
      <div>
        <label>Alquileres</label>
        <select name="id_alquiler" required [(ngModel)]="selectedMulta.id_alquiler">
          <option *ngFor="let a of alquileresOptions" [value]="a.id_alquiler">
            {{ a.display }}
          </option>
        </select>
      </div>
      <div>
        <label>Tipo</label>
        <select name="tipo" required [(ngModel)]="selectedMulta.tipo">
          <option value="Daño">Daño</option>
          <option value="Multa">Multa</option>
        </select>
      </div>

      <div>
        <label>Descripción</label>
        <textarea name="descripcion" required [(ngModel)]="selectedMulta.descripcion"></textarea>
      </div>

      <div>
        <label>Costo</label>
        <input type="number" step="0.01" name="costo" required [(ngModel)]="selectedMulta.costo" />
      </div>

      <div>
        <label>Fecha</label>
        <input type="date" name="fecha" required [(ngModel)]="selectedMulta.fecha" />
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="multaForm.invalid">{{ isEditing ? 'Actualizar' : 'Crear' }}</button>
        <button type="button" (click)="cancel()">Cancelar</button>
      </div>
    </form>

  </div>

  <div class="confirm-delete" *ngIf="toDeleteMulta">
    <p>¿Eliminar la multa <strong>{{ toDeleteMulta.descripcion }}</strong>?</p>
    <button (click)="deleteMulta(toDeleteMulta)">Sí, eliminar</button>
    <button (click)="toDeleteMulta = null">No</button>
  </div>
</div>